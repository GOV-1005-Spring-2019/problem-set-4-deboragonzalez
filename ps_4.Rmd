---
title: "Problem Set #4"
author: "Debi Gonzalez"
date: "February 24, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyverse)
library(devtools)
library(lubridate)
library(gt)
library(ggplot2)
nc_election <- read_csv("ps_4_elections-poll-nc09-3.csv")



```


## Question 1

```{r, echo = FALSE}
Dems <- nc_election %>%
  group_by(response) %>%
  count() %>%
  spread(response, n) %>%
  pull(Dem)


Reps <- nc_election %>%
  filter(response %in% c("Rep", "Dem", "Und")) %>%
  count(response) %>%
  spread(response, n) %>%
  summarize(Reps = Rep - Und)
  # I could also mutate to create the new variable and then pull the result. 

Gender <- nc_election %>%
  filter(response %in% c("Rep", "Dem", "Und")) %>%
  filter(gender != gender_combined)
  # Will use nrows() in inline code to refer to the number of individuals with different genders between the two variables. 


Race <- nc_election %>%
  filter(race_eth == "White") %>%
  filter(race_eth != file_race_black)
  

Time <-  nc_election %>%
  filter(response %in% c("Rep", "Dem")) %>%
  group_by(response) %>%
  summarize(min_time = min(timestamp)) %>%
  spread(response, min_time) %>%
  mutate(time_diff = round(Rep - Dem, digits = 0)) %>%
  select(time_diff) 
  
# Must find the min of both Reps and Dems 
  
  
```


There were `r Dems` respondents who supported the Democratic candidate.

There were `r Reps` more respondents who favored the Republican candidate than who were Undecided.

There are two gender variables (gender and gender_combined). There are `r nrow(Gender)` individuals for whom these variables have different values.

There are `r nrow(Race)` respondents listed as “White” under race_eth who are not listed as “White” under file_race_black.

The first response of Rep came `r Time` minutes (rounded to the nearest minute) before the first response of Dem.


## Question 2
```{r, echo = FALSE, results="asis"}
nc_election %>%
  select(response, race_eth, final_weight) %>%
  filter(race_eth != "[DO NOT READ] Don't know/Refused") %>% 
  mutate(race_eth = fct_relevel(race_eth, c("White", "Black", "Hispanic", "Asian", "Other"))) %>%
  group_by(response, race_eth) %>%
  summarize(total = sum(final_weight)) %>%
  spread(key =  response, value = total, fill = 0) %>% 
  ungroup() %>% 
  mutate(all = Dem + Rep + Und + `3`) %>% 
  mutate(Dem = Dem / all) %>% 
  mutate(Rep = Rep / all) %>% 
  mutate(Und = Und / all) %>% 
  select(-all, -`3`) %>% 
  na_if(0) %>%
  gt() %>% 
  fmt_percent(columns = vars(Dem, Rep, Und), decimals = 0) %>%
  cols_label(race_eth = "", Dem = "DEM.", Rep = "REP.", Und = "UND.") %>%
  tab_header(title = "Polling Results from North Carolina") %>%
  tab_source_note(source_note = "Source: 3rd wave of North Carolina 9th Congressional District Election Poll") 

```

## Question 3
```{r, echo = false}

nc_election %>%
  select(educ, final_weight) %>%
  filter(educ != "[DO NOT READ] Refused") %>% 
  mutate(educ = fct_relevel(educ, c("Grade school", "High school", "Some college or trade school", "Bachelors' degree", "Graduate or Professional Degree"))) %>%
  ggplot(aes(y= final_weight, x = educ)) +
  geom_violin() + geom_jitter(alpha = .4, width = .2) +
  coord_flip()

  

```

