---
title: "Problem Set #4"
author: "Debi Gonzalez"
date: "February 24, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
# Using this library to read in the file.
nc_election <- read_csv("ps_4_elections-poll-nc09-3.csv")

# The following libraries are necessary to access the functions necessary such as spread, filter and summarize.
library(tidyverse)
library(devtools)
library(lubridate)
library(gt)
# The gt library is necessary for the table we are going to recreate in this PSET.
library(ggplot2)
# I am using this library to create my own plot(s). Yes, I made an extra one!


```


## Question 1

```{r, echo = FALSE}
# Number of respondent who supported democratic candidate
Dems <- nc_election %>%
  group_by(response) %>%
  # Response seems to provide what people answered when asked about their political support, so I will use that one.
  count() %>%
  spread(response, n) %>%
  pull(Dem)
  # There is probably a faster way to do this, but I counted to get the number of answers per response type, then I spread it so that the types of responses become columns, and then I pull Dem to get the number of people who support democrats in the dataset.

# Difference between Republicans & Undecided
Reps <- nc_election %>%
  filter(response %in% c("Rep", "Dem", "Und")) %>%
  count(response) %>%
  spread(response, n) %>%
  summarize(Reps = Rep - Und)
  # I could also mutate to create the new variable and then pull the result. 
# For this one, I added the filter just to make it more visually appealing to me and to get rid of irrelevant third party data, however, it is not necessary. Just like last time, I counted and spread to make the affiliations columns. Then, I summarized to create a new variable made by substracting the number of undecided voters from the number of Republicans. This new value is the number of more republicans than undecided respondents.

Gender <- nc_election %>%
  filter(response %in% c("Rep", "Dem", "Und")) %>%
  filter(gender != gender_combined)
  # Will use nrows() in inline code to refer to the number of individuals with different genders between the two variables. 


Race <- nc_election %>%
  filter(race_eth == "White") %>%
  filter(race_eth != file_race_black)
  

Time <-  nc_election %>%
  filter(response %in% c("Rep", "Dem")) %>%
  group_by(response) %>%
  summarize(min_time = min(timestamp)) %>%
  spread(response, min_time) %>%
  mutate(time_diff = round(Rep - Dem, digits = 0)) %>%
  select(time_diff) 
  
# Must find the min of both Reps and Dems 
  
  
```


There were `r Dems` respondents who supported the Democratic candidate.

There were `r Reps` more respondents who favored the Republican candidate than who were Undecided.

There are two gender variables (gender and gender_combined). There are `r nrow(Gender)` individuals for whom these variables have different values.

There are `r nrow(Race)` respondents listed as “White” under race_eth who are not listed as “White” under file_race_black.

The first response of Dem came `r Time` minutes (rounded to the nearest minute) before the first response of Rep. 
(Sorry about the typo! :/)


## Question 2
```{r, echo = FALSE, results="asis"}
nc_election %>%
  select(response, race_eth, final_weight) %>%
  filter(race_eth != "[DO NOT READ] Don't know/Refused") %>% 
  mutate(race_eth = fct_relevel(race_eth, c("White", "Black", "Hispanic", "Asian", "Other"))) %>%
  group_by(response, race_eth) %>%
  summarize(total = sum(final_weight)) %>%
  spread(key =  response, value = total, fill = 0) %>% 
  ungroup() %>% 
  mutate(all = Dem + Rep + Und + `3`) %>% 
  mutate(Dem = Dem / all) %>% 
  mutate(Rep = Rep / all) %>% 
  mutate(Und = Und / all) %>% 
  select(-all, -`3`) %>% 
  na_if(0) %>%
  gt() %>% 
  fmt_percent(columns = vars(Dem, Rep, Und), decimals = 0) %>%
  cols_label(race_eth = "", Dem = "DEM.", Rep = "REP.", Und = "UND.") %>%
  tab_header(title = "Polling Results from North Carolina") %>%
  tab_source_note(source_note = "Source: New York Times Upshot/Siena College 2018 live polls") 

```

## Question 3
```{r, echo = FALSE, results="asis"}
nc_election %>%
  select(educ, final_weight) %>%
  filter(educ != "[DO NOT READ] Refused") %>% 
  mutate(educ = fct_relevel(educ, c("Grade school", "High school", "Some college or trade school", "Bachelors' degree", "Graduate or Professional Degree"))) %>%
  ggplot(aes(y= final_weight, x = educ)) +
  geom_violin() + geom_jitter(alpha = .4, width = .2) +
  coord_flip() + 
  xlab(NULL) +
  ylab("Weight Given to Respondent in Calculating Poll Results") +
  labs(title = "More Educated Matter Less in North Carolina 9th",
       subtitle = "Poll gives more weight to people who are less likely to participate in polls",
       caption = "New York Times Upshot/Siena College 2018 live polls")
```

## Question 4

```{r, echo = FALSE, results = TRUE}
# Distribution of Democrats and Republicans by Education Level by Gender.

edu_gen_party <- nc_election %>%
  select(response, gender, educ, file_race) %>%
  # These are the variables I am going to use in my plot. I selected file_race as well because I was testing this same data visual set up but with race instead of gender. There were not
  filter(educ != "[DO NOT READ] Refused", response %in% c("Rep", "Dem")) %>%
  mutate(educ = fct_relevel(educ, c("Grade school", "High school", "Some college or trade school", "Bachelors' degree", "Graduate or Professional Degree"))) %>%
  group_by(response, educ) %>%
  ggplot(aes(x=educ, y = response, color = educ)) + 
  geom_jitter(show.legend = FALSE) + 
  coord_flip() + 
  facet_wrap(~gender) +
  xlab(NULL) +
  ylab("Political Affiliation") +
  labs(title = "Political Affiliation by Education and Gender",
       caption = "New York Times Upshot/Siena College 2018 live polls")
```

## Additional Plots (just for fun)
```{r, echo = FALSE, results= TRUE}
# Distribution of Average Timestamp by Gender (jitter)

procrastination_gender_jitter <- nc_election %>%
  select(gender, timestamp) %>%
  group_by(gender, timestamp) %>%
  ggplot(aes(x=gender, y = timestamp, color =gender)) + geom_jitter(show.legend = FALSE) +
  xlab("Gender") +
  ylab("Day of Response Submission") +
  labs(title = "Timing of Response Submissions by Gender",
       caption = "New York Times Upshot/Siena College 2018 live polls")
```

```{r, echo = FALSE, results="asis"}
# Distribution of Average Timestamp by Gender (boxplot)

procrastination_gender_boxplot <- nc_election %>%
  select(gender, timestamp) %>%
  group_by(gender, timestamp) %>%
  ggplot(aes(x=gender, y = timestamp, color =gender)) + geom_boxplot(show.legend = FALSE) +
  xlab("Gender") +
  ylab("Day of Response Submission") +
  labs(title = "Timing of Response Submissions by Gender",
       caption = "New York Times Upshot/Siena College 2018 live polls")
```


## Collaborators

Diego M., Chris O., Chris M., Beau M., Dylan.